## Основной функционал бота:
Проживающий заполняет заявку на ремонт.
Заявка пересылается всем администраторам и создателю заявки (проживающему, который создал эту заявку).
Администратор может нажать на кнопку "Взять в обработку", если хочет выполнить полученную заявку
или "Отменить", если он решил, что заявка некорректна.
После нажатия администратором на одну из этих двух кнопок, у всех остальных администраторов заявка исчезает.
Если администратор нажал на кнопку "Взять в обработку", то для этой заявки появится единственная кнопка "Выполнить".
При нажатии администратора на кнопку статус заявки изменяется как у нажавшего администратора, так и у создателя заявки.
При нажатии администратором на кнопку "Выполнить" или "Отменить", эта заявку исчезает у этого администратора, но остаётся у создателя заявки.

## Детали работы:
* Старт. При вводе команды `/start` бот отправляет в очередь start_queue данные пользователя.
Консюмер start_consumer получает сообщение из очереди и добавляет в таблицу users новую запись с полученными данными.
После пользователь получает сообщение с возможностями бота.
* Регистрация. ...

## Как запустить?
* Создайте файл `config/.env` и заполните его в соответствии с шаблоном, который находится на пути `config/.env.example`.
Создайте своего бота в телеграмме (например, с помощью BotFather),
скопируйте полученный токен для доступа к HTTP API и вставьте его в качестве значения для константы BOT_TOKEN в созданном файле `config/.env`.
* Введите команду `ngrok http 8001` для того, чтобы запустить туннель с использованием инструмента ngrok,
который пробросит локальный сервер через интернет. При запуске команды Вы получите вывод, в котором будет примерно такая строка:
```
Forwarding                    https://1756-5-139-226-70.ngrok-free.app -> http://localhost:8001
```
В данном примере Вам нужно скопировать строку 'https://1756-5-139-226-70.ngrok-free.app', добавить в конец этой строки '/tg/webhook'
и вставить получившеюся строку в качестве значения для константы BOT_WEBHOOK_URL в ранее созданный файл `config/.env`.
* Введите в терминале команду `docker compose up`. Если какие-то порты недоступны для поднятия docker-контейнеров,
то убейте процессы, которые прослушивают эти порты следующими командами:
```
sudo kill $(sudo lsof -t -i :<your_port>)
sudo systemctl stop redis
sudo systemctl stop rabbitmq-server
```
Если Вы захотите посмотреть содержимое базы данных, то введите следующую команду (важно, чтобы docker compose был поднят):
```
psql -h localhost -U postgres -d postgres -p <your_port>
```
* Запустить скрипт `scripts/migrate` для создания таблиц в базе данных.
* Запустите скрипт `scripts/add_roles` для добавления стандартных ролей в таблицу roles базы данных.
* Запустите скрипт `scripts/add_application_form_statuses` для добавления стандартных статусов для заявок на ремонт в таблицу application_form_statuses базы данных.
* Запустите модуль uvicorn с параметрами `src.app:create_app --factory --port 8001`.
* Запустите всех консюмеров, которые находятся на следующих путях: `consumers/start_consumer`, `consumers/registration_consumer`, `consumers/application_form_consumer`.

## Как добавить пользователю роль администратора?
1) Запустите бота через пользователя, которому хотите добавить роль администратора.
2) Напишите команду `/get_my_telegram_id`. Бот выдаст Ваш telegram_id, который понадобиться позже.
3) Откройте проект и перейдите относительно корня проекта на локальный путь `scripts/give_user_admin_role.py`.
4) Заполните константы данными пользователя (для константы TELEGRAM_ID вставьте ранее полученный от бота telegram_id).
```
TELEGRAM_ID: int = 
FULL_NAME: str = 
PHONE_NUMBER: str = 
```
5) Запустите этот скрипт.
